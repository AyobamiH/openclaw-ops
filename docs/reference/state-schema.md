---
title: "State Schema"
summary: "Complete structure of orchestrator.state.json"
---

# State Schema

The orchestrator persists its state to `logs/orchestrator.state.json` after every task. This is the complete schema.

## Root Structure

```typescript
interface OrchestratorState {
  lastStartedAt: string;              // ISO 8601 timestamp
  tasksProcessed: number;             // Total tasks ever processed
  taskHistory: TaskRecord[];          // Last 50 tasks (rolling window)
  docsIndexed: string[];              // Indexed doc file paths
  redditResponses: RedditRecord[];    // Last 100 Reddit records (rolling)
  rssDrafts: RSSRecord[];             // Last 200 RSS items (rolling)
  deployedAgents: DeploymentRecord[]; // Agents deployed this session
  notes?: string;                      // Optional user notes
}
```

---

## TaskRecord

Represents a single executed task.

```typescript
interface TaskRecord {
  type: string;                  // Task type: "startup", "doc-sync", etc.
  status: "pending" | "completed" | "error";
  timestamp: string;             // ISO 8601 when task ran
  durationMs: number;            // How long it took
  result?: any;                  // Task-specific output
  error?: string;                // Error message (if status=="error")
}
```

**Example**:
```json
{
  "type": "doc-sync",
  "status": "completed",
  "timestamp": "2025-01-10T14:32:48.123Z",
  "durationMs": 5234,
  "result": {
    "filesIndexed": 42,
    "changeDetected": true,
    "knowledgePackGenerated": true
  }
}
```

---

## RedditRecord

Represents a Reddit response generated by the reddit-helper agent.

```typescript
interface RedditRecord {
  timestamp: string;             // When drafted
  postId: string;                // Reddit post ID
  postTitle: string;             // Reddit post title
  subreddit: string;             // Subreddit name
  draftResponse: string;         // Proposed response text
  confidence: number;            // 0-1 confidence score
  approved?: boolean;            // Whether human approved
  posted?: string;               // Actual timestamp if posted
}
```

**Example**:
```json
{
  "timestamp": "2025-01-10T14:32:48.123Z",
  "postId": "abc123xyz",
  "postTitle": "How do I...",
  "subreddit": "machinelearning",
  "draftResponse": "Based on the latest...",
  "confidence": 0.87,
  "approved": false
}
```

---

## RSSRecord

Represents an RSS feed item evaluated for relevance.

```typescript
interface RSSRecord {
  timestamp: string;             // When evaluated
  feedUrl: string;               // Source feed URL
  itemTitle: string;             // Article title
  itemUrl: string;               // Article link
  publishedAt: string;           // Publication date
  relevanceScore: number;        // 0-100 calculated score
  urgency: "high" | "medium" | "low";
  notes?: string;                // Summary or reason
}
```

**Example**:
```json
{
  "timestamp": "2025-01-10T14:32:48.123Z",
  "feedUrl": "https://example.com/feed.xml",
  "itemTitle": "Latest in AI...",
  "itemUrl": "https://...",
  "publishedAt": "2025-01-10T12:00:00.000Z",
  "relevanceScore": 87,
  "urgency": "high",
  "notes": "Matches interests: machine-learning, agents"
}
```

---

## DeploymentRecord

Represents an agent deployment event.

```typescript
interface DeploymentRecord {
  timestamp: string;             // When deployed
  agentName: string;             // Template name
  deployPath: string;            // Where deployed
  metadata: {
    version?: string;
    tags?: string[];
    config?: any;
  };
}
```

**Example**:
```json
{
  "timestamp": "2025-01-10T14:32:48.123Z",
  "agentName": "doc-specialist",
  "deployPath": "agents-deployed/doc-specialist-1705416768123",
  "metadata": {
    "version": "1.0.0",
    "tags": ["production"]
  }
}
```

---

## Rolling Windows

The orchestrator maintains rolling windows (max capacity limits) to keep state file size bounded:

| Field | Max Records | Pruning |
|-------|------------|---------|
| `taskHistory` | 50 | Remove oldest |
| `redditResponses` | 100 | Remove oldest |
| `rssDrafts` | 200 | Remove oldest |
| `deployedAgents` | — | No limit (session-local) |

When a limit is reached, the oldest record is removed before adding the new one.

---

## State Persistence

State is saved **after every completed task**:

```typescript
// From index.ts
queue.on('completed', async (task) => {
  // ... process task ...
  await saveState(state);  // ← Automatic save
});
```

This means:
- **No data loss**: State survives crashes (last state before crash is on disk)
- **Recovery**: On restart, state is automatically loaded
- **Auditability**: Every task is recorded

---

## Viewing Raw State

```bash
# Entire state (pretty-printed)
cat logs/orchestrator.state.json | jq .

# Just task history
cat logs/orchestrator.state.json | jq .taskHistory

# Last task
cat logs/orchestrator.state.json | jq .taskHistory[-1]

# All Reddit responses
cat logs/orchestrator.state.json | jq .redditResponses

# High-priority RSS items
cat logs/orchestrator.state.json | jq '.rssDrafts[] | select(.urgency=="high")'
```

---

## State Validation

The state is always valid JSON. If corrupted:

```bash
# Backup current
cp logs/orchestrator.state.json logs/orchestrator.state.json.backup

# Reset to empty
echo '{}' > logs/orchestrator.state.json

# Restart system (will re-initialize)
npm start
```

---

See [Task Types](./task-types.md) for what values appear in `result` fields.
